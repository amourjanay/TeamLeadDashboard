// Global configuration 
const CONFIG = {
  VERSION: '1.0.0',
  SHEETS: {
    CONFIG: 'SystemConfig',
    TEAM_MEMBERS: 'TeamMembers',
    ONE_ON_ONE: 'OneOnOneNotes',
    QUALITY_REVIEWS: 'QualityReviews',
    METRICS: 'Metrics',
    ACTION_ITEMS: 'ActionItems',
    ACTION_ITEM_TAGS: 'ActionItemTags',
    ACTION_ITEM_ATTACHMENTS: 'ActionItemAttachments',
    ACTION_ITEM_REMINDERS: 'ActionItemReminders',
    REMINDER_SETTINGS: 'ReminderSettings',
    COACHING: 'CoachingNotes',
    TIME_TRACKER: 'TimeTracking',
    SCHEDULE: 'Schedule',
    MANAGER_ONE_ON_ONE: 'ManagerOneOnOne',
    GENERAL_NOTES: 'GeneralNotes',
    TASKS: 'Tasks',
    ERROR_LOG: 'ErrorLog',
    USER_PROFILES: 'UserProfiles',
    NOTIFICATION_PREFS: 'NotificationPreferences',
    ASANA_INTEGRATION: 'AsanaIntegration',
    TEAM_LEAD_INFO: 'TeamLeadInfo'
  },
  DEFAULT_THEME: 'light',
  DATE_FORMAT: 'MM/dd/yyyy',
  TIME_FORMAT: 'HH:mm:ss',
  MAX_TEAM_SIZE: 50,
  METRICS: {
    ANSWER_RATE_TARGET: 0.95,
    AVG_TALK_TIME_MIN: 15,
    AVG_TALK_TIME_MAX: 20,
    ACW_TARGET: 5,
    ON_QUEUE_TARGET: 0.65,
    INTERACTING_TIME_TARGET: 0.50
  }
};

/**
 * Runs when the spreadsheet is opened
 * Creates custom menu and initializes the system if needed
 */
function onOpen() {
  try {
    const ui = SpreadsheetApp.getUi();
    
    // Add a custom menu with emojis
    ui.createMenu('ğŸ“Š Dashboard')
      .addItem('ğŸ  View Dashboard', 'showDashboard')
      .addSeparator()
      .addSubMenu(ui.createMenu('ğŸ‘¥ Team Management')
        .addItem('ğŸ‘¤ View Team Members', 'showTeamView')
        .addItem('â• Add Team Member', 'showAddTeamMemberForm')
        .addItem('ğŸ”„ Update Status', 'showUpdateStatusForm'))
      .addSeparator()
      .addSubMenu(ui.createMenu('ğŸ“‹ One-on-One Notes')
        .addItem('ğŸ“ New Session', 'showOneOnOneForm')
        .addItem('ğŸ“Š View Sessions', 'showOneOnOneNotes')
        .addItem('ğŸ“ˆ Dashboard', 'showOneOnOneDashboard')
        .addItem('ğŸ“¤ Export Options', 'showOneOnOneExport'))
      .addSeparator()
      .addSubMenu(ui.createMenu('ğŸ¤ Manager One-on-One')
        .addItem('ğŸ“ New Session', 'showManagerOneOnOneForm')
        .addItem('ğŸ“Š View Sessions', 'showManagerOneOnOneNotes')
        .addItem('ğŸ“ˆ Dashboard', 'showManagerOneOnOneDashboard'))
      .addSeparator()
      .addSubMenu(ui.createMenu('ğŸ“Š Metrics')
        .addItem('ğŸ“Š Daily Metrics', 'showMetricsForm')
        .addItem('ğŸ“ˆ Reports', 'showMetricsReports')
        .addItem('ğŸ“‰ Dashboard', 'showMetricsDashboard')
        .addItem('ğŸ“§ Email Config', 'showMetricsEmailConfig')
        .addItem('ğŸ“¤ Export', 'showMetricsExport'))
      .addSeparator()
      .addSubMenu(ui.createMenu('ğŸ§ª QA Reviews')
        .addItem('ğŸ“ New Review', 'showQAReviewForm')
        .addItem('ğŸ“Š View Reviews', 'showQAReports')
        .addItem('ğŸ“ˆ Dashboard', 'showQADashboard')
        .addItem('ğŸ“¤ Export', 'showQAExport'))
      .addSeparator()
      .addSubMenu(ui.createMenu('ğŸ“ General Notes')
        .addItem('ğŸ“ New Note', 'showGeneralNoteForm')
        .addItem('ğŸ“Š View Notes', 'showGeneralNotes')
        .addItem('ğŸ“ˆ Dashboard', 'showGeneralNotesDashboard'))
      .addSeparator()
      .addSubMenu(ui.createMenu('â±ï¸ Time & Schedule')
        .addItem('â±ï¸ Time Tracker', 'showTeamLeadTimeTracker')
        .addItem('ğŸ“Š Time Reports', 'showTimeReports')
        .addItem('ğŸ“… Manage Schedule', 'showScheduleManager')
        .addItem('ğŸ”„ Initialize Week', 'showInitializeWeekForm')
        .addItem('ğŸ“ˆ Schedule Reports', 'showScheduleReports'))
      .addSeparator()
      .addSubMenu(ui.createMenu('âœ… Tasks')
        .addItem('âœ… Add Task', 'showTaskForm')
        .addItem('ğŸŒ Add Asana Task', 'showAsanaTaskForm')
        .addItem('ğŸ“‹ View Tasks', 'showTasksList'))
      .addSeparator()
      .addSubMenu(ui.createMenu('ğŸ“Œ Action Items')
        .addItem('ğŸ“ Create Action Item', 'showActionItemsForm')
        .addItem('ğŸ“‹ View Action Items', 'showActionItemsView')
        .addItem('ğŸ”” Manage Reminders', 'showActionItemsReminders'))
      .addSeparator()
      .addSubMenu(ui.createMenu('âš™ï¸ Settings & Support')
        .addItem('âš™ï¸ System Settings', 'showSettings')
       .addItem('ğŸ‘¤ User Preferences', 'showUserPreferences')
       .addItem('â“ Help & Support', 'showHelp')
       .addItem('ğŸ”§ First Time Setup', 'showFirstTimeSetup')) // Add this line
      .addToUi();

    // Check if initialization is needed
    initializeSystemIfNeeded();
    
  } catch (error) {
    logError('onOpen', error);
  }
}
